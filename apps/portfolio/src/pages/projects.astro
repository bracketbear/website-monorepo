---
import { getCollection } from 'astro:content';
import { DetailBlock, SummaryBlock } from '@bracketbear/core';
import { getBreadcrumbs } from '@/config/breadcrumbs';
import ContentLayout from '@/layouts/ContentLayout.astro';
import ProjectCard from '@/components/ProjectCard';

const workProject = await getCollection('workProject');
const workProjectCategories = await getCollection('workProjectCategory');
const breadcrumbs = getBreadcrumbs({
  label: 'Projects',
  href: '/projects',
});

// Group projects by category
const projectsByCategory = workProjectCategories
  .map((category) => {
    const categoryProjects = workProject.filter(
      (project) => project.data.category === category.id
    );

    return {
      category,
      projects: categoryProjects,
    };
  })
  .filter((group) => group.projects.length > 0);

// Get skills for project cards
const workSkills = await getCollection('workSkills');

// Calculate some stats for detail blocks
const totalProjects = workProject.length;
const featuredProjects = workProject.filter((p) => p.data.isFeatured).length;
const totalSkills = workSkills.length;
---

<ContentLayout title="Projects" breadcrumbs={breadcrumbs} showHero={true}>
  <!-- Detail Blocks -->
  <DetailBlock
    slot="detail-blocks"
    label="Total Projects"
    value={totalProjects.toString()}
  />
  <DetailBlock
    slot="detail-blocks"
    label="Featured Projects"
    value={featuredProjects.toString()}
  />
  <DetailBlock
    slot="detail-blocks"
    label="Technologies"
    value={totalSkills.toString()}
  />

  <!-- Summary -->
  <SummaryBlock
    slot="summary"
    content="Here are the projects I've worked on, organized by category. Each project represents a unique challenge and solution that showcases different aspects of my skills and experience."
  />

  <div class="space-y-16">
    {
      projectsByCategory.map(({ category, projects }) => (
        <section class="bg-brand-dark tangible tangible-card overflow-hidden rounded-4xl p-8">
          {/* Section Title */}
          <div class="bg-brand-orange mb-8 inline-block rounded-xl py-8 pr-12 pl-6">
            <h2 class="font-heading text-brand-dark inline-block text-4xl font-black tracking-tight uppercase">
              {category.data.title}
            </h2>
          </div>

          <div class="grid gap-8 lg:grid-cols-2">
            {projects.map((project) => (
              <ProjectCard
                project={project}
                skills={workSkills}
                variant="light"
                showImage={true}
                showBadges={true}
                showSkills={true}
                maxSkills={3}
              />
            ))}
          </div>
        </section>
      ))
    }
  </div>
</ContentLayout>
