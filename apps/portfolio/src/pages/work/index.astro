---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import WorkSkillFilter from "@/components/WorkSkillFilter";

const workProjects = await getCollection("workProject");
const workSkills = await getCollection("workSkills");
const workJobs = await getCollection("workJobs");
const workCompanies = await getCollection("workCompany");
const workSkillCategories = await getCollection("workSkillCategory");

// Extract URL parameters for automatic filtering
const url = new URL(Astro.request.url);
const skillParam = url.searchParams.get("skill");
const categoryParam = url.searchParams.get("category");

// Convert URL parameters to initial filter state
const initialSelectedSkills = skillParam ? [skillParam] : [];
const initialSelectedCategories = categoryParam ? [categoryParam] : [];
---

<Layout>
  <title>Work | Harrison Callahan</title>
  <div class="bg-primary/50 py-24">
    <div class="container mx-auto px-6">
      <div class="brutalist-border bg-background mb-8 inline-block p-8">
        <h1 class="text-foreground text-5xl font-black uppercase">Work</h1>
      </div>
      <!-- Introduction -->
      <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
        <div class="p-8">
          <p class="text-foreground space-y-4 pb-5 text-2xl font-medium">
            I've been working as a software engineer for over 10 years. I've
            worked in a variety of roles, from a solo developer to a team of 12+
            engineers. I've worked in a variety of industries, from startups to
            large corporations.
          </p>
          <p class="text-foreground space-y-4 text-2xl font-medium">
            The tool below is to help you understand my skills and experience.
            <span
              class="skill-pill skill-pill-selected brutalist-border mr-1 rounded-none !text-lg"
              >Select</span
            > a skill to see projects I've worked on that use that skill, or a category
            to choose multiple skills at once. We'll filter the list of jobs and
            projects and show you the ones that match your selection.
          </p>
        </div>
      </div>
    </div>

    <div class="container mx-auto px-6 py-16">
      <WorkSkillFilter
        skills={workSkills}
        skillCategories={workSkillCategories}
        jobs={workJobs}
        projects={workProjects}
        companies={workCompanies}
        initialSkills={JSON.stringify(initialSelectedSkills)}
        intialCategories={JSON.stringify(initialSelectedCategories)}
        client:load
      />
    </div>
  </div>
</Layout>
