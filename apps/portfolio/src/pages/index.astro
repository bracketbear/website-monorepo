---
import { getCollection } from 'astro:content';
import { AstroButton } from '@bracketbear/core/astro';
import HomeLayout from '@/layouts/HomeLayout.astro';
import ContactForm from '@/components/ContactForm';
import ProjectCard from '@/components/ProjectCard';
import type {
  WorkJobEntry,
  WorkSkillEntry,
  WorkProjectEntry,
  WorkCompanyEntry,
} from '@bracketbear/astro-content';
import HeroSection from '@/components/HeroSection';
import FeaturedProjectsWaveBG from '@/components/FeaturedProjectsWaveBG';

const workJobs: WorkJobEntry[] = await getCollection('workJobs');
const workSkills: WorkSkillEntry[] = await getCollection('workSkills');
const workProjects: WorkProjectEntry[] = await getCollection('workProject');
const workCompanies: WorkCompanyEntry[] = await getCollection('workCompany');

// Sort jobs by start date (most recent first)
const sortedJobs = workJobs.sort(
  (a, b) => b.data.startDate.getTime() - a.data.startDate.getTime()
);

// Get featured projects
const featuredProjects = workProjects
  .filter((project) => project.data.isFeatured)
  .slice(0, 3);

// Helper function to format dates correctly
function formatDate(date: Date): string {
  const adjustedDate = new Date(date);
  adjustedDate.setMonth(adjustedDate.getMonth() + 1);

  return adjustedDate.toLocaleDateString('en-US', {
    month: 'short',
    year: 'numeric',
  });
}

// Helper function to get company name from company key
function getCompanyName(
  companyKey: string,
  companies: WorkCompanyEntry[]
): string {
  const company = companies.find((c) => c.id === companyKey);
  return company?.data.title || companyKey;
}
---

<HomeLayout title="Harrison Callahan - Portfolio" hideContactForm={true}>
  <!-- Hero Section with Particle Galaxy Background -->
  <HeroSection className="h-screen w-full" client:load />

  <!-- What I Do Section -->
  <section class="bg-brand-light py-24">
    <div class="container mx-auto px-6">
      <div class="mx-auto max-w-4xl text-center">
        <h2
          class="font-heading text-brand-dark mb-8 inline-block p-6 text-5xl font-black tracking-tight uppercase"
        >
          What I Do
        </h2>
        <div class="card">
          <p class="text-brand-dark mb-6 text-xl leading-relaxed font-bold">
            I'm a full-stack developer and creative technologist with a passion
            for building innovative solutions that bridge the gap between
            technology and human experience.
          </p>
          <p class="text-brand-dark/80 text-lg leading-relaxed font-medium">
            With expertise in both traditional web development and cutting-edge
            experiential technologies, I specialize in creating robust content
            management systems, interactive installations, and scalable SaaS
            platforms that not only work well today but can evolve with your
            needs tomorrow.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Projects Section -->
  <section class="bg-brand-light relative min-h-[600px] py-24">
    <FeaturedProjectsWaveBG
      className="absolute inset-0 z-0 h-full w-full"
      client:load
    >
      <div class="relative z-10 container mx-auto px-6">
        <div class="mb-16 text-center">
          <h2
            class="font-heading text-brand-dark mb-8 inline-block p-6 text-5xl font-black tracking-tight uppercase"
          >
            Featured Projects
          </h2>
          <p class="text-brand-dark/80 mx-auto max-w-2xl text-xl">
            Here's a taste of what I've been building. Each project represents a
            unique challenge and showcases different aspects of my skills.
          </p>
        </div>
        <div class="grid gap-8 lg:grid-cols-3">
          {
            featuredProjects.map((project) => (
              <ProjectCard
                project={project}
                skills={workSkills}
                variant="dark"
              />
            ))
          }
        </div>
        <div class="mt-12 text-center">
          <a href="/projects">
            <AstroButton variant="primary" size="lg"
              >View All Projects →</AstroButton
            >
          </a>
        </div>
      </div>
    </FeaturedProjectsWaveBG>
  </section>

  <!-- Recent Experience Section -->
  <section class="bg-brand-dark py-24">
    <div class="container mx-auto px-6">
      <div class="mb-16 text-center">
        <h2
          class="font-heading text-brand-light mb-8 inline-block p-6 text-5xl font-black tracking-tight uppercase"
        >
          Recent Experience
        </h2>
        <p class="text-brand-light/80 mx-auto max-w-2xl text-xl">
          My journey spans from agency work at experiential marketing firms to
          freelance development, giving me a unique perspective on both
          technical and business challenges.
        </p>
      </div>
      <div class="mx-auto max-w-4xl space-y-8">
        {
          sortedJobs.slice(0, 3).map((job) => (
            <div class="card-dark">
              <div class="mb-4 flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                  <h3 class="font-heading text-brand-light text-2xl font-black uppercase">
                    {job.data.title}
                  </h3>
                  <p class="text-brand-light/80 text-xl">
                    {getCompanyName(job.data.company, workCompanies)}
                  </p>
                </div>
                <div class="mt-2 text-right md:mt-0">
                  <p class="text-brand-light/60 font-bold">
                    {formatDate(job.data.startDate)} -
                    {job.data.endDate
                      ? formatDate(job.data.endDate)
                      : 'Present'}
                  </p>
                </div>
              </div>
              {job.data.description && (
                <p class="text-brand-light mb-4">{job.data.description}</p>
              )}
              {job.data.highlights && job.data.highlights.length > 0 && (
                <ul class="mb-4 list-inside list-disc space-y-1">
                  {job.data.highlights.slice(0, 3).map((highlight: string) => (
                    <li class="text-brand-light/80">{highlight}</li>
                  ))}
                </ul>
              )}
              {job.data.workSkills && job.data.workSkills.length > 0 && (
                <div class="flex flex-wrap gap-2">
                  {job.data.workSkills.map((skillKey: string) => {
                    const skill = workSkills.find((s) => s.id === skillKey);
                    return skill ? (
                      <span class="pill pill-skill">{skill.data.title}</span>
                    ) : null;
                  })}
                </div>
              )}
            </div>
          ))
        }
      </div>
      <div class="mt-12 text-center">
        <a href="/work">
          <AstroButton variant="secondary" size="lg"
            >View Full Work History →</AstroButton
          >
        </a>
      </div>
    </div>
  </section>

  <!-- Let's Connect Section -->
  <section class="bg-brand-dark py-24">
    <div class="container mx-auto px-6">
      <div class="mx-auto max-w-4xl text-center">
        <h2
          class="font-heading text-brand-light mb-8 p-6 text-5xl font-black tracking-tight uppercase"
        >
          Let's Work Together
        </h2>
        <p class="text-brand-light/80 mx-auto mb-12 max-w-2xl text-xl">
          Ready to build something amazing? Whether you have a project in mind
          or just want to chat about possibilities, I'd love to hear from you.
        </p>
        <div class="card bg-brand-light">
          <ContactForm client:load />
        </div>
      </div>
    </div>
  </section>
</HomeLayout>
