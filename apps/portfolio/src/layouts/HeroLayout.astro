---
/**
 * HeroLayout - Local hero layout with AnimationStage background and transparent nav
 *
 * This layout provides a hero section with AnimationStage for particle backgrounds
 * and transparent navigation overlay, similar to the homepage.
 *
 * Usage:
 * <HeroLayout
 *   pageTitle="My Projects"
 *   hero={page.hero}
 *   breadcrumbs={breadcrumbs}
 * >
 *   <!-- Page content here -->
 * </HeroLayout>
 */
import Layout from './Layout.astro';
import { clsx, type ObjectValues } from '@bracketbear/core';
import { generatePortfolioMetaTitle } from '@/config/meta-title';
import { HeroSection } from '@/components/HeroSection';
import ErrorBoundary from '@/components/ErrorBoundary';
import type { ControlValues } from '@bracketbear/flateralus';

const presets = {
  'curious-particle-network': 'curious-particle-network',
  'particle-wave': 'particle-wave',
  blob: 'blob',
  'enhanced-wave': 'enhanced-wave',
  'retro-grid': 'retro-grid',
} as const;
type Preset = ObjectValues<typeof presets>;

export interface Props {
  pageTitle?: string;
  title?: string;
  subtitle?: string;
  description?: string;
  ctaText?: string;
  ctaHref?: string;
  stats?: any[];
  hideContactForm?: boolean;
  hideFooter?: boolean;
  hideNavigation?: boolean;
  breadcrumbs?: any;
  hero?: any;
  animationPreset?: Preset;
  animationControls?: ControlValues;
  container?: boolean;
  contactCTA?: {
    text: string;
    buttonText: string;
    buttonLink: string;
  };
  metaDescription?: string;
  currentPage?: string;
}

const {
  pageTitle,
  animationPreset = 'particle-wave' as const,
  container = true,
  contactCTA,
  metaDescription,
  currentPage,
  ...props
} = Astro.props;

// Generate meta title from page title
const metaTitle = pageTitle ? generatePortfolioMetaTitle(pageTitle) : undefined;
---

<Layout
  {...props}
  hideNavigation={false}
  title={metaTitle}
  description={metaDescription}
  class="bg-background"
  navigationVariant="glass"
  currentPage={currentPage}
>
  <!-- Header Section with Flateralus Animation -->
  {
    props.title && (
      <ErrorBoundary client:load>
        <HeroSection
          preset={presets[animationPreset]}
          showDebugControls={true}
          enableLuminanceDetection={true}
          title={props.title}
          subtitle={props.subtitle}
          description={props.description}
          stats={props.stats}
          showActions={false}
          accountForNavigation={true}
          accountForBreadcrumbs={true}
          isIndexPage={false}
          client:load
        />
      </ErrorBoundary>
    )
  }

  <!-- Page Content -->
  <div
    class={clsx(props.title ? 'py-16' : 'py-12', props.hideFooter && 'pb-0')}
  >
    <div class={clsx(container && 'container mx-auto')}>
      <slot />
    </div>
  </div>

  <!-- Contact CTA Section -->
  {
    contactCTA && (
      <div class="bg-muted py-12">
        <div class="container mx-auto">
          <div class="mx-auto max-w-4xl text-center">
            <p class="text-muted-foreground/90 mb-8 text-xl leading-relaxed font-medium">
              {contactCTA.text}
            </p>
            <a
              href={contactCTA.buttonLink}
              class="button button-primary button-lg"
            >
              {contactCTA.buttonText}
            </a>
          </div>
        </div>
      </div>
    )
  }
</Layout>
